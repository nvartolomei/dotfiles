#!/usr/bin/env bash

# Get current WiFi Password (source: https://github.com/rauchg/wifi-password/)

airport="/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport"
ssid="`$airport -I | awk '/ SSID/ {print substr($0, index($0, $2))}'`"

if [ "$ssid" = "" ]; then
    echo "ERROR: Could not retrieve current SSID. Are you connected?" >&2
    exit 1
fi

# source: http://blog.macromates.com/2006/keychain-access-from-shell/
pwd="`security find-generic-password -ga \"$ssid\" 2>&1 >/dev/null`"

# clean up password
echo $pwd | sed -e "s/^.*\"\(.*\)\".*$/\1/"
